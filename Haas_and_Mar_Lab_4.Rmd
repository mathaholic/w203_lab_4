---
title: 'Lab 4: Healthy Momma, Healthy Baby'
author: "Krista Mar and Nikki Haas"
date: "12/1/2016"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### A Nice Introduction that Makes Us Sound Like Pros


All work and no play makes Nikki a dull girl.  All work and no play makes Nikki a dull girl.  All work and no play makes Nikki a dull girl.  All work and no play makes Nikki a dull girl.  All work and no play makes Nikki a dull girl.  All work and no play makes Nikki a dull girl.  All work and no play makes Nikki a dull girl.  All work and no play makes Nikki a dull girl.  All work and no play makes Nikki a dull girl. All work and no play makes Nikki a dull girl. All work and no play makes Nikki a dull girl. All work and no play makes Nikki a dull girl. All work and no play makes Nikki a dull girl. All work and no play makes Nikki a dull girl.  All work and no play makes Nikki a dull girl.  All work and no play makes Nikki a dull girl.

Something about higher birthweight that talks about neural development [big babies, big brains](http://sciencenordic.com/birth-weight-predicts-brain-development)

### Step 1: Read in the Data

```{r}
load('/Users/nicholeh/student285/w203/w203_lab_4/bwght_w203.RData')
desc
```

### Step 2: Exploratory Data Analysis

First, get summary statistics on each element of the dataset:


```{r}
nrow(data)

summary(data)


```


##### *Response Variables*

The bwght, lbwght, omaps and fmaps variables are related to the health of the baby.

The first thing to check is if these variables are collinar.  We will omit bwghts as that is a function of lbwghts.

```{r}
library(ggplot2)
cor(data$omaps, data$fmaps, use = "complete.obs")
cor(data$lbwght, data$fmaps, use = "complete.obs")
p <- ggplot(data, aes(omaps, lbwght)) + geom_point(size = 0.25) + 
  geom_smooth(method = "lm", se = FALSE) + geom_point(aes(colour = fmaps)) +
  ggtitle("Scatterplot of log(weight) against One Minute APGAR test,\n
          with 5 minute APGAR test heatmap")
p
```


```{r}
p <- ggplot(data, aes(factor(fmaps), lbwght)) + geom_boxplot() 
p
```


Look at the extreme fmops case
```{r}
data[data$fmaps< 4,]
```


Looking at the data, we can be reasonably assured that the response variables are related, but not collinear. It may be best to make a combined variable of `fmaps` and `omaps` such as `mapscombined = fmaps + omaps`.  The difference would not make much sense compared to the sum; 10 - 10 and 2 - 2 are both zero, after all.  


##### *Regressors*

The variables monpre and npvis are related to the prenatal care given during pregnancy.  Let us review them for collinearity:
```{r}
cor(data$npvis, data$monpre, use = "complete.obs")
ggplot(data, aes(monpre, npvis)) + geom_point(size = 0.25) + 
  geom_smooth(method = "lm", se = FALSE) + geom_jitter()
ggplot(data, aes(factor(monpre), npvis)) + geom_boxplot() 
```

From this set, we can see that the data is not collinear, and indeed we can see that we might have some reporting errors.  5 mothers are listed as starting prenatal care in month 0 of their pregnancy, but they visited the doctor 0 times.  These probably denote missing information or an error in reporting.  Unfortunately, this data does show a definitive downward trend leading us to suspect that the number of visits is a function of month prenatal care began.  This makes sense intuitively; if a mother starts prenatal care in her 2nd month of pregnancy, she has ample time for frequent doctor visits.  However, if she starts her prenatal care towards the end of her pregnancy, she does not have enough time to visit the doctor as often as a woman who started in month 2.

```{r}
ggplot(data, aes(x=monpre)) + geom_histogram(aes(y = ..count..),bins = 10) +
  ggtitle("Month Prenatal Care began") 
ggplot(data, aes(x=sqrt(monpre))) + geom_histogram(aes(y = ..count..), bins = 10) +
  ggtitle("Month Prenatal Care Began, Half Power")
ggplot(data, aes(x=log(monpre))) + geom_histogram(aes(y = ..count..), bins = 10) + 
  ggtitle("Month Prenatal Care Began, Natural Log")
ggplot(data, aes(x=(monpre^2))) + geom_histogram(aes(y = ..count..), bins = 10) +
  ggtitle("Month Prenatal Care Began, Square Power")
ggplot(data, aes(x=npvis)) + geom_histogram(aes(y = ..count..), bins = 15) + 
  ggtitle("Number of Prenatal Visits")
```



All in all, the number of visits follows a mostly normal curve, and the square root of the month prenatal care began follow a mostly normal curve.  Then we say smart things about how that will all relate to each other.


### Step 3: Modeling 

##### Model 1: Basic Linear Model

First we will check variants on the requested model; baby health as a function of the mother's prenatal care.  We will not 
```{r}
model1 = lm(data$bwght ~ data$monpre + data$npvis)
model1
model2 = lm(data$lbwght ~ data$monpre + data$npvis)
model2
model3 = lm(data$bwght ~ sqrt(data$monpre) + data$npvis)
model3
model4 = lm(data$lbwght ~ sqrt(data$monpre) + data$npvis)
model4
AIC(model1)
AIC(model2)
AIC(model3)
AIC(model4)
```

##### Model 2: An Alternate Main Model

The 1 minute and 5 minute APGAR scores on their own do not tell us much. As we can see from the heatmap on the first scatterplot, a baby who has a low one minute score tends to have a higher five minute score.  There are very few examples of a baby having a worse five minute score than a one minute score:

```{r}
nrow(data[!is.na(data$fmaps) < !is.na(data$omaps),])
```

However, we can get some information if we sum up `omaps` and `fmaps`.  A baby that goes from 0 to 10 then would have an overal low score compared to a baby who started with a score of 10 and was still at 10 5 minutes later.

```{r}
data$combinded_apgarscores = data$omaps + data$fmaps
```

Now that we have a calculated field that sums up the APGAR tests, we can try an alternate linear model:

```{r}
a1 = lm(data$combinded_apgarscores ~ data$monpre + data$npvis)
a3 = lm(data$combinded_apgarscores ~  data$npvis)
summary(a1)
summary(a3)
AIC(a1)
AIC(a3)
```

Our AIC scores tell us that a1 more efficient, so let us exlore a1 further:

```{r}
plot(a1)
```


```{r}
data$product_apgarscores = data$omaps * data$fmaps

```

```{r}
a5 = lm(data$product_apgarscores ~ data$monpre + data$npvis)
summary(a5)
AIC(a5)
plot(a5)

```

This data is not looking good either. Let's try removing the non-normally distributed `data$monpre` field

```{r}
a6 = lm(data$product_apgarscores ~ data$npvis)
summary(a6)
AIC(a6)
plot(a6)
```

Unfortunately that too is a little worse.  Let's try normalizing these calculated values:

```{r}
data$normalized_combined_apgar = (data$combinded_apgarscores - mean(!is.na(data$combinded_apgarscores)))/sd(!is.na(data$combinded_apgarscores))
data$normalized_product_apgar =  (data$product_apgarscores- mean(!is.na(data$product_apgarscores)))/sd(!is.na(data$product_apgarscores))

a7 = lm(data$normalized_combined_apgar~data$monpre + data$npvis)
a8 =lm(data$normalized_product_apgar~data$monpre + data$npvis)
summary(a7)
summary(a8)
```


We did not see very good results with the APGAR score variations, so now let's try to normalize the baby's birth weight by APGAR.


#### Model 4: Problematic covariants

We will select the attributes of baby's gender and parent's race as well.  In the United States, it is a sad fact that minorities such as African Americans do not have adequate access to proper health care as often as non-minorities.  Their babies might not fare as well, and their mothers may not get the proper prenatal care. 

```{r}
c1 = lm(data$bwght ~ data$npvis + data$male +
          data$mblck + data$fblck)
summary(c1)
AIC(c1)
plot(c1)
```

From all of the summaries, we can tell that the t-statistic for the `monpre` variable is not significant.  Thus, we cannot trust this particular regressor, as the summary statistics on this regressor suggested.

### Step 4: CLM and the Models


### Step 5: Regression Tables and Model Analysis

### Step 6: Causality


### Biases and Limitation

This data is extremely biased in that no still births were included in our dataset.  It is a sad fact in the United States that over 2 in 1,000 births are [stillbirths](https://www.washingtonpost.com/news/wonk/wp/2014/09/29/our-infant-mortality-rate-is-a-national-embarrassment/?utm_term=.58dedfd178fd).  Since we do not know the prenatal care data for stillbirths, we cannot completely guage how much prenatal care contributes to a child's health at birth.


In addition, it appears that there is little correlation between the Apgar score and the later health of the baby.  The Apar is only meant to be used in the context of emergency situations.  In this manner, looking at a baby's weight will give us deeper insight into the baby's overall health.



### Step 7: Conclusion



